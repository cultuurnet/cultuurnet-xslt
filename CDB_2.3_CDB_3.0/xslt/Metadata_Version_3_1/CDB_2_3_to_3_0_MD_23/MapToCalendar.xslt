<?xml version="1.0" encoding="ISO-8859-1"?><xsl:stylesheet version="1.0"  xmlns="http://www.cultuurdatabank.com/XMLSchema/CdbXSD/3.1/DRAFT" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:md="http://www.cultuurdatabank.be/XMLSchema/metadata" xmlns:xalan="http://xml.apache.org/xalan" xmlns:ot="http://www.cultuurdatabank.be/XMLSchema/opening_times" xmlns:ed="http://www.cultuurdatabank.be/XMLSchema/event_date" exclude-result-prefixes="md xsl xalan ot ed">	<xsl:output method="xml" version="1.0" encoding="ISO-8859-1" indent="yes"/>	<xsl:include href="summary.xslt"/>	<xsl:template name="insertCalendar">		<!-- first establish which sort on an calenda we want : period, permanent or timestamp -->		<xsl:choose>			<xsl:when test="string(event_base_type) = 'permanent'">				<xsl:call-template name="permanent"/>			</xsl:when>			<xsl:when test="string(event_type) = 'periode'">				<xsl:call-template name="periode"/>			</xsl:when>			<xsl:otherwise>				<xsl:call-template name="timestamp"/>			</xsl:otherwise>		</xsl:choose>	</xsl:template>	<xsl:template name="timestamp">		<calendar>			<timestamps>				<xsl:for-each select="ot:opening_times">					<xsl:for-each select="opening_times_instance">						<!-- we have to make sure that we don't include a time here that is already in event_date, so if  -->						<!-- ot:opening_times/opening_times_instance = ed:event_date/event_date_instance/ot:opening_times/opening_times_instance then do nothing -->						<xsl:choose>														<xsl:when test="time_start = ../../ed:event_date/event_date_instance/ot:opening_times/opening_times_instance/time_start 																		and 														time_end = ../../ed:event_date/event_date_instance/ot:opening_times/opening_times_instance/time_end														 ">							</xsl:when> 							<!-- do nothing -->							<!--  <xsl:when test = "1=0"></xsl:when> -->														<xsl:otherwise>								<timestamp>									<xsl:for-each select="time_start">										<xsl:variable name="time_start" select="."/>										<xsl:variable name="substringResult" select="substring($time_start, '1', '10')"/>										<date>											<xsl:value-of select="$substringResult"/>										</date>									</xsl:for-each>									<xsl:if test="substring(time_start,12,8) != '00:00:00' and substring(time_start,12,5) !='23:59'">										<xsl:for-each select="time_start">											<xsl:variable name="time_start1" select="."/>											<xsl:variable name="substringResult1" select="substring($time_start1, '12',8)"/>											<timestart>												<xsl:value-of select="$substringResult1"/>											</timestart>										</xsl:for-each>									</xsl:if>									<xsl:if test="substring(time_end,12,8) != '00:00:00' and substring(time_end,12,5) !='23:59'">										<xsl:for-each select="time_end">											<xsl:variable name="time_end" select="."/>											<xsl:variable name="substringResult2" select="substring($time_end, '12',8)"/>											<xsl:if test=". != ../time_start">												<timeend>													<xsl:value-of select="$substringResult2"/>												</timeend>											</xsl:if>										</xsl:for-each>									</xsl:if>								</timestamp>							</xsl:otherwise>						</xsl:choose>					</xsl:for-each>				</xsl:for-each>				<!-- Add availability from the information in event_date  -->				<!-- verplaatst (tijdstip gewijzigd)   verplaatst (locatie gewijzigd)   uitverkocht    geannuleerd   onbepaald   -->				<xsl:for-each select="ed:event_date/event_date_instance">					<xsl:if test="string(availability_type) != 'onbepaald' and string(availability_type) != 'verplaatst (locatie gewijzigd)' and string(ot:opening_times/opening_times_instance/time_start) != ''">											<xsl:choose>							<xsl:when test="string(availability_type) = 'verplaatst (tijdstip gewijzigd)'">								<timestamp>									<availability>										<newtime>											<xsl:for-each select="opening_times_new/opening_times_instance">												<xsl:for-each select="time_start">													<xsl:variable name="time_start" select="."/>													<xsl:variable name="substringResult" select="substring($time_start, '1', '10')"/>													<date>														<xsl:value-of select="$substringResult"/>													</date>												</xsl:for-each>												<xsl:if test="substring(time_start,12,8) != '00:00:00' and substring(time_start,12,5) !='23:59'">													<xsl:for-each select="time_start">														<xsl:variable name="time_start1" select="."/>														<xsl:variable name="substringResult1" select="substring($time_start1, '12',8)"/>														<timestart>															<xsl:value-of select="$substringResult1"/>														</timestart>													</xsl:for-each>												</xsl:if>												<xsl:if test="substring(time_end,12,8) != '00:00:00' and substring(time_end,12,5) !='23:59'">													<xsl:for-each select="time_end">														<xsl:variable name="time_end" select="."/>														<xsl:variable name="substringResult2" select="substring($time_end, '12',8)"/>														<xsl:if test=". != ../time_start">															<timeend>																<xsl:value-of select="$substringResult2"/>															</timeend>														</xsl:if>													</xsl:for-each>												</xsl:if>											</xsl:for-each>										</newtime>									</availability>									<xsl:for-each select="ot:opening_times/opening_times_instance">										<xsl:for-each select="time_start">											<xsl:variable name="time_start" select="."/>											<xsl:variable name="substringResult" select="substring($time_start, '1', '10')"/>											<date>												<xsl:value-of select="$substringResult"/>											</date>										</xsl:for-each>										<xsl:if test="substring(time_start,12,8) != '00:00:00' and substring(time_start,12,5) !='23:59'">										<xsl:for-each select="time_start">												<xsl:variable name="time_start1" select="."/>												<xsl:variable name="substringResult1" select="substring($time_start1, '12',8)"/>												<timestart>													<xsl:value-of select="$substringResult1"/>												</timestart>											</xsl:for-each>										</xsl:if>										<xsl:if test="substring(time_end,12,8) != '00:00:00' or substring(time_end,12,5) !='23:59'">											<xsl:for-each select="time_end">												<xsl:variable name="time_end" select="."/>												<xsl:variable name="substringResult2" select="substring($time_end, '12',8)"/>												<xsl:if test=". != ../time_start">													<timeend>														<xsl:value-of select="$substringResult2"/>													</timeend>												</xsl:if>											</xsl:for-each>										</xsl:if>									</xsl:for-each>								</timestamp>							</xsl:when>							<xsl:when test="string(availability_type) = 'verplaatst (locatie gewijzigd)'">								<!-- wait...the bexml does not handle this correctly yet -->							</xsl:when>							<xsl:when test="string(availability_type) = 'uitverkocht'">															<timestamp>									<availability>										<soldout>											<xsl:value-of select="true()"/>										</soldout>									</availability>									<xsl:for-each select="ot:opening_times/opening_times_instance">										<xsl:for-each select="time_start">											<xsl:variable name="time_start" select="."/>											<xsl:variable name="substringResult" select="substring($time_start, '1', '10')"/>											<date>												<xsl:value-of select="$substringResult"/>											</date>										</xsl:for-each>										<xsl:if test="substring(time_start,12,8) != '00:00:00' and substring(time_start,12,5) !='23:59'">											<xsl:for-each select="time_start">												<xsl:variable name="time_start1" select="."/>												<xsl:variable name="substringResult1" select="substring($time_start1, '12',8)"/>												<timestart>													<xsl:value-of select="$substringResult1"/>												</timestart>											</xsl:for-each>										</xsl:if>										<xsl:if test="substring(time_end,12,8) != '00:00:00' or substring(time_end,12,5) !='23:59'">											<xsl:for-each select="time_end">												<xsl:variable name="time_end" select="."/>												<xsl:variable name="substringResult2" select="substring($time_end, '12',8)"/>												<xsl:if test=". != ../time_start">													<timeend>														<xsl:value-of select="$substringResult2"/>													</timeend>												</xsl:if>											</xsl:for-each>										</xsl:if>									</xsl:for-each>								</timestamp>							</xsl:when>							<xsl:when test="string(availability_type) = 'geannuleerd'">								<timestamp>									<availability>										<cancelled>											<xsl:value-of select="true()"/>										</cancelled>									</availability>									<xsl:for-each select="ot:opening_times/opening_times_instance">										<xsl:for-each select="time_start">											<xsl:variable name="time_start" select="."/>											<xsl:variable name="substringResult" select="substring($time_start, '1', '10')"/>											<date>												<xsl:value-of select="$substringResult"/>											</date>										</xsl:for-each>										<xsl:if test="substring(time_start,12,8) != '00:00:00' and substring(time_start,12,5) !='23:59'">											<xsl:for-each select="time_start">												<xsl:variable name="time_start1" select="."/>												<xsl:variable name="substringResult1" select="substring($time_start1, '12',8)"/>												<timestart>													<xsl:value-of select="$substringResult1"/>												</timestart>											</xsl:for-each>										</xsl:if>										<xsl:if test="substring(time_end,12,8) !='00:00:00' or substring(time_end,12,5) !='23:59'">											<xsl:for-each select="time_end">												<xsl:variable name="time_end" select="."/>												<xsl:variable name="substringResult2" select="substring($time_end, '12',8)"/>												<xsl:if test=". != ../time_start">													<timeend>														<xsl:value-of select="$substringResult2"/>													</timeend>												</xsl:if>											</xsl:for-each>										</xsl:if>									</xsl:for-each>								</timestamp>							</xsl:when>							<xsl:otherwise/>						</xsl:choose>					</xsl:if>				</xsl:for-each>			</timestamps>		</calendar>	</xsl:template>	<xsl:template name="permanent">		<calendar>			<permanentopeningtimes>				<permanent>					<!-- first run through opening_times looking for exceptions -->					<xsl:variable name="exception">						<xsl:for-each select="ot:opening_times">							<xsl:for-each select="opening_times_instance">								<xsl:if test="string(year) != '1970'">									<xsl:value-of select="'1'"/>								</xsl:if>							</xsl:for-each>						</xsl:for-each>					</xsl:variable>					<xsl:if test="$exception &gt;= 1">						<exceptions>							<xsl:for-each select="ot:opening_times">								<xsl:for-each select="opening_times_instance">									<xsl:if test="string(year) != '1970'">																			<timestamp>											<xsl:attribute name="opentype">												<xsl:choose>													<xsl:when test="string(open_type) = 'gesloten'">														<xsl:value-of select="'closed'"/>													</xsl:when>													<xsl:when test="string(open_type) = 'open op afspraak'">														<xsl:value-of select="'byappointment'"/>													</xsl:when>													<xsl:otherwise>														<xsl:value-of select="'open'"/>													</xsl:otherwise>												</xsl:choose>																						</xsl:attribute>											<date>												<xsl:value-of select="substring(time_start, '1', '10')"/>											</date>											<!--											<opentype>												<xsl:choose>													<xsl:when test="string(open_type) = 'gesloten'">														<xsl:value-of select="'closed'"/>													</xsl:when>													<xsl:when test="string(open_type) = 'open op afspraak'">														<xsl:value-of select="'byappointment'"/>													</xsl:when>													<xsl:otherwise>														<xsl:value-of select="'open'"/>													</xsl:otherwise>												</xsl:choose>											</opentype>-->											<xsl:if test="substring(time_start,12,8) != '00:00:00' and substring(time_start,12,5) !='23:59'">												<timestart>													<xsl:value-of select="substring(time_start, '12',8)"/>												</timestart>											</xsl:if>											<xsl:if test="substring(time_end,12,8) !='00:00:00' or substring(time_end,12,5) !='23:59'">												<xsl:if test="time_start != time_end">													<timeend>														<xsl:value-of select="substring(time_end, '12',8)"/>													</timeend>												</xsl:if>											</xsl:if>										</timestamp>									</xsl:if>								</xsl:for-each>							</xsl:for-each>						</exceptions>					</xsl:if>					<!-- no week schema needed if ot:opening_times contain an instance of each day that is open and whose hours are						1970-01-01T23:59:00+01:00 -->					<xsl:variable name="relevant_weekscheme">						<xsl:for-each select="ot:opening_times">							<xsl:for-each select="opening_times_instance[open_type = 'open' and day_type = 'maandag']">								<xsl:value-of select="time_start"></xsl:value-of>							</xsl:for-each>							<xsl:for-each select="opening_times_instance[open_type = 'open' and day_type = 'dinsdag']">								<xsl:value-of select="time_start"></xsl:value-of>							</xsl:for-each>							<xsl:for-each select="opening_times_instance[open_type = 'open' and day_type = 'woensdag']">								<xsl:value-of select="time_start"></xsl:value-of>							</xsl:for-each>							<xsl:for-each select="opening_times_instance[open_type = 'open' and day_type = 'donderdag']">								<xsl:value-of select="time_start"></xsl:value-of>							</xsl:for-each>							<xsl:for-each select="opening_times_instance[open_type = 'open' and day_type = 'vrijdag']">								<xsl:value-of select="time_start"></xsl:value-of>							</xsl:for-each>							<xsl:for-each select="opening_times_instance[open_type = 'open' and day_type = 'zaterdag']">								<xsl:value-of select="time_start"></xsl:value-of>							</xsl:for-each>							<xsl:for-each select="opening_times_instance[open_type = 'open' and day_type = 'zondag']">								<xsl:value-of select="time_start"></xsl:value-of>							</xsl:for-each>						</xsl:for-each>										</xsl:variable>					<!-- no week schema if there is no full week schema -->					<xsl:variable name="full_weekscheme">						<xsl:for-each select="ot:opening_times">							<xsl:for-each select="opening_times_instance[year = '1970' and day_type = 'maandag']">								<xsl:value-of select="'1'"></xsl:value-of>							</xsl:for-each>							<xsl:for-each select="opening_times_instance[year = '1970' and day_type = 'dinsdag']">								<xsl:value-of select="'2'"></xsl:value-of>							</xsl:for-each>							<xsl:for-each select="opening_times_instance[year = '1970' and day_type = 'woensdag']">								<xsl:value-of select="'3'"></xsl:value-of>							</xsl:for-each>							<xsl:for-each select="opening_times_instance[year = '1970' and day_type = 'donderdag']">								<xsl:value-of select="'4'"></xsl:value-of>							</xsl:for-each>							<xsl:for-each select="opening_times_instance[year = '1970' and day_type = 'vrijdag']">								<xsl:value-of select="'5'"></xsl:value-of>							</xsl:for-each>							<xsl:for-each select="opening_times_instance[year = '1970' and day_type = 'zaterdag']">								<xsl:value-of select="'6'"></xsl:value-of>							</xsl:for-each>							<xsl:for-each select="opening_times_instance[year = '1970' and day_type = 'zondag']">								<xsl:value-of select="'7'"></xsl:value-of>							</xsl:for-each>						</xsl:for-each>										</xsl:variable>					<xsl:if test="contains($full_weekscheme,'1') and  contains($full_weekscheme,'2') and contains($full_weekscheme,'3') and contains($full_weekscheme,'4') and contains($full_weekscheme,'5') and contains($full_weekscheme,'6') and contains($full_weekscheme,'7')">					<!--<xsl:if test="contains('XML','XM')">-->				<xsl:if test="string($relevant_weekscheme) != '1970-01-01T23:59:00+01:001970-01-01T23:59:00+01:001970-01-01T23:59:00+01:001970-01-01T23:59:00+01:001970-01-01T23:59:00+01:001970-01-01T23:59:00+01:001970-01-01T23:59:00+01:00'">									<xsl:for-each select="ot:opening_times">								<weekscheme>									<monday>										<xsl:call-template name="insert_day_info">											<xsl:with-param name="day" select="'maandag'"/>										</xsl:call-template>									</monday>									<tuesday>										<xsl:call-template name="insert_day_info">											<xsl:with-param name="day" select="'dinsdag'"/>										</xsl:call-template>									</tuesday>									<wednesday>										<xsl:call-template name="insert_day_info">											<xsl:with-param name="day" select="'woensdag'"/>										</xsl:call-template>									</wednesday>									<thursday>										<xsl:call-template name="insert_day_info">											<xsl:with-param name="day" select="'donderdag'"/>										</xsl:call-template>									</thursday>									<friday>										<xsl:call-template name="insert_day_info">											<xsl:with-param name="day" select="'vrijdag'"/>										</xsl:call-template>									</friday>									<saturday>										<xsl:call-template name="insert_day_info">											<xsl:with-param name="day" select="'zaterdag'"/>										</xsl:call-template>									</saturday>									<sunday>										<xsl:call-template name="insert_day_info">											<xsl:with-param name="day" select="'zondag'"/>										</xsl:call-template>									</sunday>								</weekscheme>					</xsl:for-each>					</xsl:if>					</xsl:if>				</permanent>			</permanentopeningtimes>		</calendar>	</xsl:template>	<xsl:template name="periode">		<calendar>			<periods>				<period>					<datefrom>						<xsl:value-of select="substring(date_from, '1', '10')"/>					</datefrom>					<dateto>						<xsl:value-of select="substring(date_to, '1', '10')"/>					</dateto>					<!-- first run through opening_times looking for exceptions -->					<!-- there is a problem with some events : The week scheme has year = 2006 and 'real' dates -->					<!-- to check for this we will assume that if there are 7 opening_times instances then that is a week scheme with -->					<!-- no exceptions  -->					<xsl:variable name="exception">						<xsl:for-each select="ot:opening_times">							<xsl:for-each select="opening_times_instance">								<xsl:if test="string(year) != '1970' and substring(time_start,1,4) != '1970'">									<xsl:value-of select="'1'"/>								</xsl:if>							</xsl:for-each>						</xsl:for-each>					</xsl:variable>					<xsl:if test="$exception &gt;= 1">						<exceptions>							<xsl:for-each select="ot:opening_times">								<xsl:for-each select="opening_times_instance">									<xsl:if test="string(year) != '1970' and substring(time_start,1,4) != '1970'">										<timestamp>										<xsl:attribute name="opentype">												<xsl:choose>													<xsl:when test="string(open_type) = 'gesloten'">														<xsl:value-of select="'closed'"/>													</xsl:when>													<xsl:when test="string(open_type) = 'open op afspraak'">														<xsl:value-of select="'byappointment'"/>													</xsl:when>													<xsl:otherwise>														<xsl:value-of select="'open'"/>													</xsl:otherwise>												</xsl:choose>																						</xsl:attribute>											<date>												<xsl:value-of select="substring(time_start, '1', '10')"/>											</date>											<!--											<opentype>												<xsl:choose>													<xsl:when test="string(open_type) = 'gesloten'">														<xsl:value-of select="'closed'"/>													</xsl:when>													<xsl:when test="string(open_type) = 'open op afspraak'">														<xsl:value-of select="'byappointment'"/>													</xsl:when>													<xsl:otherwise>														<xsl:value-of select="'open'"/>													</xsl:otherwise>												</xsl:choose>											</opentype>-->											<xsl:if test="substring(time_start,12,8) != '00:00:00' and substring(time_start,12,5) !='23:59'">												<timestart>													<xsl:value-of select="substring(time_start, '12',8)"/>												</timestart>											</xsl:if>											<xsl:if test="substring(time_end,12,8) != '00:00:00' and substring(time_end,12,5) !='23:59'">												<xsl:if test="time_start != time_end">													<timeend>														<xsl:value-of select="substring(time_end, '12',8)"/>													</timeend>												</xsl:if>											</xsl:if>										</timestamp>									</xsl:if>								</xsl:for-each>							</xsl:for-each>						</exceptions>					</xsl:if>					<xsl:for-each select="ot:opening_times">						<weekscheme>							<monday>								<xsl:call-template name="insert_day_info">									<xsl:with-param name="day" select="'maandag'"/>								</xsl:call-template>							</monday>							<tuesday>								<xsl:call-template name="insert_day_info">									<xsl:with-param name="day" select="'dinsdag'"/>								</xsl:call-template>							</tuesday>							<wednesday>								<xsl:call-template name="insert_day_info">									<xsl:with-param name="day" select="'woensdag'"/>								</xsl:call-template>							</wednesday>							<thursday>								<xsl:call-template name="insert_day_info">									<xsl:with-param name="day" select="'donderdag'"/>								</xsl:call-template>							</thursday>							<friday>								<xsl:call-template name="insert_day_info">									<xsl:with-param name="day" select="'vrijdag'"/>								</xsl:call-template>							</friday>							<saturday>								<xsl:call-template name="insert_day_info">									<xsl:with-param name="day" select="'zaterdag'"/>								</xsl:call-template>							</saturday>							<sunday>								<xsl:call-template name="insert_day_info">									<xsl:with-param name="day" select="'zondag'"/>								</xsl:call-template>							</sunday>						</weekscheme>					</xsl:for-each>				</period>			</periods>		</calendar>	</xsl:template>	<!-- add the week schedule. Each day tag and opentype can only appear once. -->	<xsl:template name="insert_day_info">		<xsl:param name="day"/>		<xsl:for-each select="opening_times_instance[day_type=$day]">			<xsl:variable name="first" select="position()"/>			<xsl:if test="string(year) = 1970 or substring(time_start,1,4) = '1970' or count(../opening_times_instance) = 7">				<xsl:variable name="open_type">					<xsl:choose>						<xsl:when test="string(open_type) = 'gesloten'">							<xsl:value-of select="'closed'"/>						</xsl:when>						<xsl:when test="string(open_type) = 'open op afspraak'">							<xsl:value-of select="'byappointment'"/>						</xsl:when>						<xsl:otherwise>							<xsl:value-of select="'open'"/>						</xsl:otherwise>					</xsl:choose>				</xsl:variable>				<!--				<xsl:choose>									<xsl:when test="string(day_type) = 'maandag' and string($day) = 'maandag'">						<xsl:if test="$first=1">							<xsl:attribute name="opentype"><xsl:value-of select="$open_type"/></xsl:attribute>						</xsl:if>						<openingtime>							<xsl:attribute name="from"><xsl:value-of select="substring(time_start, '12')"/></xsl:attribute>							<xsl:attribute name="to"><xsl:value-of select="substring(time_end, '12')"/></xsl:attribute>						</openingtime>					</xsl:when>					<xsl:when test="string(day_type) = 'dinsdag' and string($day) = 'dinsdag'">						<xsl:if test="$first=1">							<xsl:attribute name="opentype"><xsl:value-of select="$open_type"/></xsl:attribute>						</xsl:if>						<openingtime>							<xsl:attribute name="from"><xsl:value-of select="substring(time_start, '12')"/></xsl:attribute>							<xsl:attribute name="to"><xsl:value-of select="substring(time_end, '12')"/></xsl:attribute>						</openingtime>					</xsl:when>					<xsl:when test="string(day_type) = 'woensdag' and string($day) = 'woensdag'">						<xsl:if test="$first=1">							<xsl:attribute name="opentype"><xsl:value-of select="$open_type"/></xsl:attribute>						</xsl:if>						<openingtime>							<xsl:attribute name="from"><xsl:value-of select="substring(time_start, '12')"/></xsl:attribute>							<xsl:attribute name="to"><xsl:value-of select="substring(time_end, '12')"/></xsl:attribute>						</openingtime>					</xsl:when>					<xsl:when test="string(day_type) = 'donderdag' and string($day) = 'donderdag'">						<xsl:if test="$first=1">							<xsl:attribute name="opentype"><xsl:value-of select="$open_type"/></xsl:attribute>						</xsl:if>						<openingtime>							<xsl:attribute name="from"><xsl:value-of select="substring(time_start, '12')"/></xsl:attribute>							<xsl:attribute name="to"><xsl:value-of select="substring(time_end, '12')"/></xsl:attribute>						</openingtime>					</xsl:when>					<xsl:when test="string(day_type) = 'vrijdag' and string($day) = 'vrijdag'">						<xsl:if test="$first=1">							<xsl:attribute name="opentype"><xsl:value-of select="$open_type"/></xsl:attribute>						</xsl:if>						<openingtime>							<xsl:attribute name="from"><xsl:value-of select="substring(time_start, '12')"/></xsl:attribute>							<xsl:attribute name="to"><xsl:value-of select="substring(time_end, '12')"/></xsl:attribute>						</openingtime>					</xsl:when>					<xsl:when test="string(day_type) = 'zaterdag' and string($day) = 'zaterdag'">						<xsl:if test="$first=1">							<xsl:attribute name="opentype"><xsl:value-of select="$open_type"/></xsl:attribute>						</xsl:if>						<openingtime>							<xsl:attribute name="from"><xsl:value-of select="substring(time_start, '12')"/></xsl:attribute>							<xsl:attribute name="to"><xsl:value-of select="substring(time_end, '12')"/></xsl:attribute>						</openingtime>					</xsl:when>					<xsl:when test="string(day_type) = 'zondag' and string($day) = 'zondag'">						<xsl:if test="$first=1">							<xsl:attribute name="opentype"><xsl:value-of select="$open_type"/></xsl:attribute>						</xsl:if>						<openingtime>							<xsl:attribute name="from"><xsl:value-of select="substring(time_start, '12')"/></xsl:attribute>							<xsl:attribute name="to"><xsl:value-of select="substring(time_end, '12')"/></xsl:attribute>						</openingtime>					</xsl:when>			</xsl:choose>-->				<xsl:if test="$first=1">					<xsl:attribute name="opentype"><xsl:value-of select="$open_type"/></xsl:attribute>				</xsl:if>				<xsl:if test="substring(time_start,12,8) != '00:00:00' and substring(time_end,12,8) != '00:00:00' and  substring(time_start,12,5) !='23:59' and  substring(time_end,12,5) !='23:59'">					<openingtime>						<!---->						<xsl:if test="substring(time_start,12,8) != '00:00:00' and substring(time_start,12,5) !='23:59'">							<xsl:attribute name="from"><xsl:value-of select="substring(time_start, '12',8)"/></xsl:attribute>						</xsl:if>						<xsl:if test="substring(time_end,12,8) != '00:00:00' and substring(time_end,12,5) !='23:59'">							<xsl:attribute name="to"><xsl:value-of select="substring(time_end, '12',8)"/></xsl:attribute>						</xsl:if>					</openingtime>				</xsl:if>			</xsl:if>		</xsl:for-each>	</xsl:template>	<xsl:template name="insertSummary">		<calendarsummary>			<!-- first establish which sort on an calenda we want : period, permanent or timestamp -->			<xsl:choose>				<xsl:when test="string(event_base_type) = 'permanent'">					<!-- <xsl:call-template name="permanent_summary"/> -->					<xsl:call-template name="org_summary"/>				</xsl:when>				<xsl:when test="string(event_type) = 'periode'">					<xsl:call-template name="period_summary"/>				</xsl:when>				<xsl:otherwise>					<xsl:call-template name="tijdelijk_summary"/>				</xsl:otherwise>			</xsl:choose>		</calendarsummary>	</xsl:template></xsl:stylesheet>